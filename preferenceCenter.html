%%[ 
  SET @subscriberKey = 'raulnabarret@gmail.com' 
 
]%%

<script runat="server" language="JavaScript">
    Platform.Load("core","1");

    var api = new Script.Util.WSProxy();

    var subscriptionStatus = Subscriber.Retrieve({
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue("@subscriberKey")
      });

    var emailAddress = subscriptionStatus[0].EmailAddress;

    if(subscriptionStatus[0].Status == "Active") {
        Variable.SetValue("subscriptionStatusActive", true);
    } else {
        Variable.SetValue("subscriptionStatusActive", false);
    }

    Variable.SetValue("@EmailAddress", emailAddress);

    var cols = [
        "SubscriberKey",
        "ListID",
        "Status"
    ];

    //Get Quaterly Newsletter
    var qnFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12608"
    };

    var qnFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var qnComplexFilter = {
        LeftOperand: qnFilter1,
        LogicalOperator: "AND",
        RightOperand: qnFilter2
    }

    var result1 = api.retrieve("ListSubscriber", cols, qnComplexFilter);
    if(result1.Results[0].Status === 'Active') {
        Variable.SetValue("@quaterlyNewsletterIsActive",true);
    } else {
        Variable.SetValue("@quaterlyNewsletterIsActive",false);
    }
    //Get Quaterly Newsletter

    //Get MetaECHO Newsletter
    var menFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12704"
    };

    var menFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var menJoinFilter = {
        LeftOperand: menFilter1,
        LogicalOperator: "AND",
        RightOperand: menFilter2
    }

    var menResult = api.retrieve("ListSubscriber", cols, menJoinFilter);
    if(menResult.Results[0].Status === 'Active') {
        Variable.SetValue("@metaECHONewsletterIsActive",true);
    } else {
        Variable.SetValue("@metaECHONewsletterIsActive",false);
    }
    //Get MetaECHO Newsletter

    //Get NM Programs Newsletter
    var nmpnFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12705"
    };

    var nmpnFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var nmpnJoinFilter = {
        LeftOperand: nmpnFilter1,
        LogicalOperator: "AND",
        RightOperand: nmpnFilter2
    }

    var nmpnResult = api.retrieve("ListSubscriber", cols, nmpnJoinFilter);
    if(nmpnResult.Results[0].Status === 'Active') {
        Variable.SetValue("@nmProgramsNewsletterIsActive",true);
    } else {
        Variable.SetValue("@nmProgramsNewsletterIsActive",false);
    }
    //Get NM Programs Newsletter

    //Get SuperHubs Newsletter
    var shnFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12706"
    };

    var shnFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var shnJoinFilter = {
        LeftOperand: shnFilter1,
        LogicalOperator: "AND",
        RightOperand: shnFilter2
    }

    var shnResult = api.retrieve("ListSubscriber", cols, shnJoinFilter);
    if(shnResult.Results[0].Status === 'Active') {
        Variable.SetValue("@superHubsNewsletterIsActive",true);
    } else {
        Variable.SetValue("@superHubsNewsletterIsActive",false);
    }
    //Get SuperHubs Newsletter

    //Get CDC Advanced HIV Disease
    var cdcAdvFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12630"
    };

    var cdcAdvFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var cdcAdvComplexFilter = {
        LeftOperand: cdcAdvFilter1,
        LogicalOperator: "AND",
        RightOperand: cdcAdvFilter2
    }

    var result3 = api.retrieve("ListSubscriber", cols, cdcAdvComplexFilter);
    if(result3.Results[0].Status === 'Active') {
        Variable.SetValue("@cdcAdvancedHIVDiseaseIsActive",true);
    } else {
        Variable.SetValue("@cdcAdvancedHIVDiseaseIsActive",false);
    }
    //Get CDC Advanced HIV Disease

    //Infection Prevention and Control Global Community
    var ipcgcFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12707"
    };

    var ipcgcFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var ipcgcJoinFilter = {
        LeftOperand: ipcgcFilter1,
        LogicalOperator: "AND",
        RightOperand: ipcgcFilter2
    }

    var ipcgcResult = api.retrieve("ListSubscriber", cols, ipcgcJoinFilter);
    if(ipcgcResult.Results[0].Status === 'Active') {
        Variable.SetValue("@infectionPreventionControlGlobalCommunityIsActive",true);
    } else {
        Variable.SetValue("@infectionPreventionControlGlobalCommunityIsActive",false);
    }
    //Infection Prevention and Control Global Community

    //WHO Nursing and Midwifery
    var wnmFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12708"
    };

    var wnmFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var wnmJoinFilter = {
        LeftOperand: wnmFilter1,
        LogicalOperator: "AND",
        RightOperand: wnmFilter2
    }

    var wnmResult = api.retrieve("ListSubscriber", cols, wnmJoinFilter);
    if(wnmResult.Results[0].Status === 'Active') {
        Variable.SetValue("@whoNursingMidwiferyIsActive",true);
    } else {
        Variable.SetValue("@whoNursingMidwiferyIsActive",false);
    }
    //WHO Nursing and Midwifery

    //WHO HQ AMR
    var whaFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12709"
    };

    var whaFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var whaJoinFilter = {
        LeftOperand: whaFilter1,
        LogicalOperator: "AND",
        RightOperand: whaFilter2
    }

    var whaResult = api.retrieve("ListSubscriber", cols, whaJoinFilter);
    if(whaResult.Results[0].Status === 'Active') {
        Variable.SetValue("@whoHQAMRIsActive",true);
    } else {
        Variable.SetValue("@whoHQAMRIsActive",false);
    }
    //WHO HQ AMR

    //WHO AFRO Lab vCOP (SURGE)
    var walvsFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12710"
    };

    var walvsFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var walvsJoinFilter = {
        LeftOperand: walvsFilter1,
        LogicalOperator: "AND",
        RightOperand: walvsFilter2
    }

    var walvsResult = api.retrieve("ListSubscriber", cols, walvsJoinFilter);
    if(walvsResult.Results[0].Status === 'Active') {
        Variable.SetValue("@whoAfroLabVCOPIsActive",true);
    } else {
        Variable.SetValue("@whoAfroLabVCOPIsActive",false);
    }
    //WHO AFRO Lab vCOP (SURGE)

    //WHO Global IPC Community of Practice Platform
    var wgicppFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12711"
    };

    var wgicppFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var wgicppJoinFilter = {
        LeftOperand: wgicppFilter1,
        LogicalOperator: "AND",
        RightOperand: wgicppFilter2
    }

    var wgicppResult = api.retrieve("ListSubscriber", cols, wgicppJoinFilter);
    if(wgicppResult.Results[0].Status === 'Active') {
        Variable.SetValue("@whoGlobalIPCCommunityPracticePlatformIsActive",true);
    } else {
        Variable.SetValue("@whoGlobalIPCCommunityPracticePlatformIsActive",false);
    }
    //WHO Global IPC Community of Practice Platform

    //Global Palliative Care ECHO Partnership
    var gpcepFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12712"
    };

    var gpcepFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var gpcepJoinFilter = {
        LeftOperand: gpcepFilter1,
        LogicalOperator: "AND",
        RightOperand: gpcepFilter2
    }

    var gpcepResult = api.retrieve("ListSubscriber", cols, gpcepJoinFilter);
    if(gpcepResult.Results[0].Status === 'Active') {
        Variable.SetValue("@globalPallativeCareECHOPartnershipIsActive",true);
    } else {
        Variable.SetValue("@globalPallativeCareECHOPartnershipIsActive",false);
    }
    //Global Palliative Care ECHO Partnership

    //Cancer Initiative
    var ciFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12713"
    };

    var ciFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var ciJoinFilter = {
        LeftOperand: ciFilter1,
        LogicalOperator: "AND",
        RightOperand: ciFilter2
    }

    var ciResult = api.retrieve("ListSubscriber", cols, ciJoinFilter);
    if(ciResult.Results[0].Status === 'Active') {
        Variable.SetValue("@cancerInitiativeIsActive",true);
    } else {
        Variable.SetValue("@cancerInitiativeIsActive",false);
    }
    //Cancer Initiative

    //COVID19 Vaccination - Building Global Capacity
    var cvbgcFilter1 = {
        Property: "ListID",
        SimpleOperator: "equals",
        Value: "12714"
    };

    var cvbgcFilter2 = {
        Property: "SubscriberKey",
        SimpleOperator: "equals",
        Value: Variable.GetValue('@subscriberKey')
    };
    var cvbgcJoinFilter = {
        LeftOperand: cvbgcFilter1,
        LogicalOperator: "AND",
        RightOperand: cvbgcFilter2
    }

    var cvbgcResult = api.retrieve("ListSubscriber", cols, cvbgcJoinFilter);
    if(cvbgcResult.Results[0].Status === 'Active') {
        Variable.SetValue("@covid19VaccinationIsActive",true);
    } else {
        Variable.SetValue("@covid19VaccinationIsActive",false);
    }
    //COVID19 Vaccination - Building Global Capacity
</script>
<style type="text/css">
    .wrapper{
        color: #dfdfdf;
    }
  h1, h2 {
    color: ##ccc;
    text-transform: uppercase;
    margin: 0;
  }

  form {
    margin: 0;
  }

  .header-wrapper {
    margin-bottom: 2em;
  }

  .subheader-wrapper {
    margin-bottom: 0.25em;
  }

  .wrapper {
    display: flex;
      height: calc(100% + 16px);
      margin: -8px;
  }

  .image-wrapper {
    display: flex;
      flex-direction: column;
      justify-content: space-around;
      width: 50%;
      height: 100%;
  }

  .image-wrapper:after {
      content: ' ';
      border-top: 40vh solid #007a86;
      border-right: 10vw solid transparent;
      width: 0;
      position: absolute;
      top: 0;
  }

  .image-wrapper:after {
      content: ' ';
        border-bottom: 60vh solid #007a86;
      border-right: 10vw solid transparent;
      width: 0;
      position: absolute;
      bottom: 0;
  }

  img {
    margin: 0 auto; 
  }

  .content-wrapper {
    font-family: 'Arial';
      width: 50%;
      background: #007a86;
      padding: 2em;
  }

  .section-wrapper {
      margin-top: 1em;
      border-bottom: 1px solid #9bcace;
      padding-bottom: 1em;
  }

  .input-wrapper {
      display: flex;
      flex-direction: column;
      width: 33%;
      padding-left: 0.5em;
  }

  input {
    border: none;
    padding: 6px;
  }

  .checkbox-wrapper {
      display: flex;
      flex-direction: row;
      padding-left: 0.5em;
  }

  .button-wrapper {
    margin-top: 0.5em;
    padding-left: 0.5em;
  }

  button {
    cursor: pointer;
    background: #9bcace;
      color: #63666a;
      padding: 0.5em;
      min-width: 150px;
      border-radius: 0;
      border: none;
  }
</style>
<div class="wrapper">
  <div class="content-wrapper">
    <div class="header-wrapper">
      <h1>Email Preference Center</h1>
    </div>
    <div class="section-wrapper" style="border: none;">
      <div class="subheader-wrapper">
        <h2>Update Your Email Address</h2>  
      </div>
        <form action="%%=CloudPagesURL(7688)=%%" method="post">
            <input type="text" hidden name="formType" id="formType" value="email">
            <input type="text" hidden name="subscriberKey" id="subscriberKey" value="%%=v(@subscriberKey)=%%">
            <div class="input-wrapper">
                <label>Email Address</label>
                <input type="email" name="emailAddress" id="emailAddress" value="%%=v(@EmailAddress)=%%">
            </div>
            <div class="button-wrapper">
                <button type="submit">Update</button>
            </div>
        </form>
    </div>
    <form action="%%=CloudPagesURL(7688)=%%" method="post" >
        <input type="text" hidden name="formType" id="formType" value="preferences">
        <input type="text" hidden name="subscriberKey" id="subscriberKey" value="%%=v(@subscriberKey)=%%">
      <div class="section-wrapper">
        <div class="subheader-wrapper">
          <h2>Newsletters</h2>  
        </div>
        <div>
            <!---->
            <div class="checkbox-wrapper">
                <input type="checkbox" name="quarterlyNewsletters" id="quarterlyNewsletters" %%[ IF @quaterlyNewsletterIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="quarterlyNewsletters">Quarterly Newsletters</label>
            </div>
            <!---->
            <div class="checkbox-wrapper">
                <input type="checkbox" name="metaECHONewsletter" id="metaECHONewsletter" %%[ IF @metaECHONewsletterIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="metaECHONewsletter">Meta ECHO Newsletter</label>
            </div>
            <!---->
            <div class="checkbox-wrapper">
                <input type="checkbox" name="nmProgramsNewsletter" id="nmProgramsNewsletter" %%[ IF @nmProgramsNewsletterIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="nmProgramsNewsletter">NM Programs Newsletter</label>
            </div>
            <!---->
            <div class="checkbox-wrapper">
                <input type="checkbox" name="superHubsNewsletter" id="superHubsNewsletter" %%[ IF @superHubsNewsletterIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="superHubsNewsletter">SuperHubs Newsletter</label>
            </div>
            <!---->
        </div>
      </div>  
      <div class="section-wrapper">
        <div>
          <h2 class="subheader-wrapper">Programs</h2> 
        </div>
        <div>
            <div class="checkbox-wrapper">
                <input type="checkbox" name="cdcAdvancedHIVDisease" id="cdcAdvancedHIVDisease" %%[ IF @cdcAdvancedHIVDiseaseIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="cdcAdvancedHIVDisease">CDC Advanced HIV Disease</label>
            </div>
            <!---->
            <div class="checkbox-wrapper">
                <input type="checkbox" name="infectionPreventionControlGlobalCommunity" id="infectionPreventionControlGlobalCommunity" %%[ IF @infectionPreventionControlGlobalCommunityIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="infectionPreventionControlGlobalCommunity">Infection Prevention and Control Global Community</label>
            </div>
            <div class="checkbox-wrapper">
                <input type="checkbox" name="whoNursingMidwifery" id="whoNursingMidwifery" %%[ IF @whoNursingMidwiferyIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="whoNursingMidwifery">WHO Nursing and Midwifery</label>
            </div>
            <div class="checkbox-wrapper">
                <input type="checkbox" name="whoHQAMR" id="whoHQAMR" %%[ IF @whoHQAMRIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="whoHQAMR">WHO HQ AMR</label>
            </div>
            <div class="checkbox-wrapper">
                <input type="checkbox" name="whoAfroLabVCOP" id="whoAfroLabVCOP" %%[ IF @whoAfroLabVCOPIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="whoAfroLabVCOP">WHO AFRO Lab vCOP (SURGE)</label>
            </div>
            <div class="checkbox-wrapper">
                <input type="checkbox" name="whoGlobalIPCCommunityPracticePlatform" id="whoGlobalIPCCommunityPracticePlatform" %%[ IF @whoGlobalIPCCommunityPracticePlatformIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="whoGlobalIPCCommunityPracticePlatform">WHO Global IPC Community of Practice Platform</label>
            </div>
            <div class="checkbox-wrapper">
                <input type="checkbox" name="globalPallativeCareECHOPartnership" id="globalPallativeCareECHOPartnership" %%[ IF @globalPallativeCareECHOPartnershipIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="globalPallativeCareECHOPartnership">Global Palliative Care ECHO Partnership</label>
            </div>
            <div class="checkbox-wrapper">
                <input type="checkbox" name="cancerInitiative" id="cancerInitiative" %%[ IF @cancerInitiativeIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="cancerInitiative">Cancer Initiative</label>
            </div>
            <div class="checkbox-wrapper">
                <input type="checkbox" name="covid19Vaccination" id="covid19Vaccination" %%[ IF @covid19VaccinationIsActive==true THEN ]%%checked="checked" %%[ ENDIF ]%%>
                <label for="covid19Vaccination">COVID19 Vaccination - Building Global Capacity</label>
            </div>
        </div>
      </div>        
      <div class="section-wrapper" style="border: none;">
        <div class="checkbox-wrapper">
            %%[IF @subscriptionStatusActive THEN]%%
                <input type="checkbox" name="allSubscriptions" id="allSubscriptions">
                <label for="allSubscriptions">Unsubscribe from all email communications</label>
            %%[ELSE]%%
                <input type="checkbox" name="resubscribeAllSubscriptions" id="resubscribeAllSubscriptions">
                <label for="resubscribeAllSubscriptions">Subscribe to all email communications</label>            
            %%[ENDIF]%%
        </div>
      </div>
      <div class="button-wrapper">
        <button type="submit">Save Preferences</button>
      </div>
    </form>
  </div>
  <div class="image-wrapper">
    <img style="width: 50%;" src="https://image.s12.sfmc-content.com/lib/fe28117371640475771d78/m/1/b3f98663-541a-4193-aeef-532127ba111d.png" />
    <img style="width: 100%;" src="https://image.s12.sfmc-content.com/lib/fe28117371640475771d78/m/1/440d1024-6fac-43bd-ae2c-b92e6d51b3cb.png" />
  </div>
</div>  